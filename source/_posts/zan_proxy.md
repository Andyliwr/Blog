---
layout: post
title: 开发神器zan-proxy
comments: true
tags:
  - default
photos:
  - 'https://img.vim-cn.com/59/d7f8814d0f67906eee5ab7c3e0a2ee00bb2f26.jpg'
date: 2019-07-25 17:24:18
updated: 2019-07-25 17:24:18
---

### 前言
早在2018年就听说过zan-proxy，当时总结起来就是zan-proxy能做的，fiddler都能做，也就没必要学了。但是入职有赞之后强制要求用这个，所以只能学一波了。
我觉得zan-proxy相比fiddler有如下几个优点：
1. 实现https抓包更简单，android我没试过，不过在ios上真的使用zan-proxy实现了https抓包
2. 功能比fiddler更加简洁，更方便使用。
好了，不吹这么多了，这篇文章就是告诉你怎么使用zan-proxy

### zan-proxy安装
zan-proxy是开源项目，可以通过npm安装命令行，也可以直接下载对应操作系统的安装文件，具体的安装方法和下载地址你可以访问zan-proxy的[github地址](https://github.com/youzan/zan-proxy/)

安装好之后点击图片图标启动

![2019-07-25-17-40-35](https://file.lantingshucheng.com/2019-07-25-17-40-35.png?img)

若果应用没有启动，可能被系统阻止了，可以去系统偏好设置中的安全性与隐私，选择仍要打开，并打开。
具体可参考：https://jingyan.baidu.com/article/f71d60377960651ab741d140.html





启动时可能会询问系统的密码，填入即可，这是代理在导入并信任证书。





第一次启动时候会做一些初始化，并会自动重启，等待即可。当弹出如下提示就可以正常使用啦~



使用
三个代理模式：
独立模式（需要浏览器插件）（原名干净模式）

需要配合浏览器插件使用，具体可参考：Chrome代理设置

规则模式（系统级别代理）（原名PAC模式）

Zan proxy根据转发规则和host文件自动生成pac文件，所有配置的规则和host的请求都会自动经过代理



全局模式（系统级别代理）

所有http和https的请求都会经过代理。



如果不想安装浏览器插件，可以直接选择 规则模式 或者 全局模式 。
 

切换环境
桌面版预设了三个环境：QA-SC, 预发-多人，Daily-SC，在主界面对应项目点击 开关 即可完成环境的切换。





通知栏的图标也可以进行操作。



关闭开关 就可以恢复到正常线上环境。





环境编辑


编辑完成后，点击 保存 就能使用啦





手机端设置代理说明
iPhone
 进入设置→无线局域网
点击已连接wifi右侧按钮（公司里一般是Youzan-office）

点击配置代理

选择手动，然后服务器ip填自己电脑的ip (按住option键的同时点击电脑上方的wifi图标即可)，端口号填8001

最后点击存储即可


安卓
安卓手机设置代理与iPhone基本一样。由于安卓机型比较多，设置方式可能稍有差异，代理的设置一般在高级设置里。



常见问题

1.手机证书无法下载
请确认手机代理是否已经正确设置。需要与电脑处于同一网络环境，且代理ip设置为电脑ip，端口8001。

或直接下载证书，手动复制到手机进行安装

2.安卓手机安装证书失败
解决方案：

1、不要用手机自带的浏览器下载crt文件。

下载一个第三方的浏览器，再下载crt文件。

2、安装证书：不要直接点击crt文件进行安装。

正确安装方法有2个：

其一：设置——WiFi——高级设置——安装证书

其二：设置——更多设置——系统安全——从存储设备安装证书

3.安装证书后还是无法正常代理
iphone代理到电脑，在安装证书后需要信任证书，信任证书的方式如下：

「设置」——「通用」——「关于本机」—— 拉到底部「证书信任设置」 —— 把 「zProxy」的开关打开 —— 完成



4.无法启动，卡在同步流程（旧版）或闪退
一般是配置文件出现了错误，可以查看  ~/Library/Logs/Zan Proxy/log.log 日志文件，看下是哪个文件解析报错，删除对应的文件，重新启动即可

5.手动修改配置文件名后失效
zan-proxy 对  host规则、转发规则的文件是通过文件名字符串匹配的，若修改了文件名，可能会对规则匹配产生影响

###
这是一段文字

### 结束
如果你有更好的建议或者困惑的地方，都可以发送邮件到我的邮箱 - [andyliwr@outlook.com](andyliwr@outlook.com)
